var REGIST={checkInput:function(){checkPhone("a");if(""==$("#TANGRAM__PSP_3__phoneError").text()&&(checkUsername("a"),""==$("#TANGRAM__PSP_3__userNameError").text()&&(checkPassword("a"),""==$("#TANGRAM__PSP_3__passwordError").text())))return!0},doRegist:function(){var a=new JSEncrypt;a.setPublicKey($("#publicKey").val());var b=$("#registForm input[name='password']").val();a=a.encrypt(b);a={username:$("#registForm input[name='username']").val(),password:a,RSAKey:$("#RSAKey").val(),verifyCode:$("#inputverifyCode").val(),
phoneNum:$("#inputPhone").val(),pid:$("#pid").val()};$.ajax({url:"http://passport.727pan.cn/v2/api/regphone",type:"post",data:a,xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){1==a.respCode?location.href="http://727pan.cn/disk/home":alert(a.respMsg)}})},regist:function(){this.checkInput()&&this.doRegist()}};
$(function(){$("#TANGRAM__PSP_3__submit").click(function(){REGIST.regist()});$("#dialog").dialog({autoOpen:!1});$("#TANGRAM__PSP_3__verifyCodeSend").click(function(){checkPhone("b");""==!$("#TANGRAM__PSP_3__phoneError").text()||""==$("#inputPhone").val()?""==$("#inputPhone").val()&&$("#TANGRAM__PSP_3__phoneError").text("\u8bf7\u8f93\u5165\u624b\u673a\u53f7"):($.ajax({url:"http://passport.727pan.cn/v2/regphonesend",type:"post",data:{phoneNum:$("#inputPhone").val()},xhrFields:{withCredentials:!0},crossDomain:!0,
dataType:"json",success:function(a){1==a.respCode?($("#vcodestr").val(a.respData),$("#checkImg").attr("src",getImg(a.respData)),$("#verfiCode").val(""),$("#TANGRAM__PSP_3__verifyCodeSEError").html(""),$("#dialog").dialog("open")):$("#TANGRAM__PSP_3__verifyCodeSEError").html("\u9a8c\u8bc1\u7801\u9519\u8bef")}}),$("#dialog").dialog({modal:!0,minWidth:500}))});$("#regVerfiCode").click(function(){var a=$("#verfiCode").val(),b=$("#inputPhone").val(),c=$("#vcodestr").val();$.ajax({url:"http://passport.727pan.cn/v2/regphonesend",
type:"post",data:{phoneNum:b,VerfyCode:a,vcodestr:c},xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){1==a.respCode?($("#dialog").dialog("close"),new invokeSettime("#TANGRAM__PSP_3__verifyCodeSend")):$("#TANGRAM__PSP_3__verifyCodeSEError").html(a.respMsg)}})});$("#TANGRAM__PSP_4__password").focus(function(){$(this).hasClass("input-focus")||($(this).addClass("input-focus"),$.get("http://passport.727pan.cn/cgi/getPublickKey",function(a){$("#publicKey").val(a.respMap.publicKey);
$("#RSAKey").val(a.respMap.RSAKey)}))});$("#TANGRAM__PSP_4__password").blur(function(){$(this).removeClass("input-focus")});$("#inputUsername").bind("blur",function(){checkUsername("b")});$("#inputPhone").bind("blur",function(){checkPhone("b")});$("#TANGRAM__PSP_4__password").bind("blur",function(){checkPassword("b")})});
function invokeSettime(a){function b(a){0==c?($(a).attr("disabled",!1),$(a).val("\u83b7\u53d6\u9a8c\u8bc1\u7801"),c=60):($(a).attr("disabled",!0),$(a).val("("+c+") s \u91cd\u65b0\u53d1\u9001"),c--,setTimeout(function(){b(a)},1E3))}var c=60;b(a)}
function checkUsername(a){if(""!=$("#registForm input[name='username']").val())$.ajax({url:"http://passport.727pan.cn/v2/regcheckusername",type:"post",data:{username:$("#registForm input[name='username']").val()},xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){if(0==a.respCode)return $("#TANGRAM__PSP_3__userNameError").html(a.respMsg),!1;$("#TANGRAM__PSP_3__userNameError").html("");return!0}});else return"a"==a?$("#TANGRAM__PSP_3__userNameError").html("\u8bf7\u8f93\u5165\u7528\u6237\u540d"):
$("#TANGRAM__PSP_3__userNameError").html(""),!1}
function checkPhone(a){if(""!=$("#inputPhone").val())$.ajax({url:"http://passport.727pan.cn/v2/regcheckphone",type:"post",data:{phoneNum:$("#inputPhone").val()},xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){if(0==a.respCode)return $("#TANGRAM__PSP_3__phoneError").html(a.respMsg),!1;if(144==a.respCode)$("#inputPhone").val(""),alert("\u8be5\u624b\u673a\u53f7\u5df2\u88ab\u6ce8\u518c\uff0c\u8bf7\u66f4\u6362");else return $("#TANGRAM__PSP_3__phoneError").html(""),!0}});
else{if("a"==a)return $("#TANGRAM__PSP_3__phoneError").html("\u8bf7\u8f93\u5165\u624b\u673a\u53f7"),!1;$("#TANGRAM__PSP_3__phoneError").html("");return!1}}
function checkPassword(a){var b=$("#registForm input[name='password']").val();if(""!=b)a=new JSEncrypt,a.setPublicKey($("#publicKey").val()),b=a.encrypt(b),$.ajax({url:"http://passport.727pan.cn/cgi/regcheckpwd",type:"post",data:{password:b,RSAKey:$("#RSAKey").val()},xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){if(0==a.respCode)return $("#TANGRAM__PSP_3__passwordError").html(a.respMsg),!1;$("#TANGRAM__PSP_3__passwordError").html("");return!0}});else{if("a"==a)return $("#TANGRAM__PSP_3__passwordError").html("\u8bf7\u8f93\u5165\u5bc6\u7801"),
!1;$("#TANGRAM__PSP_3__passwordError").html("");return!1}}function getImg(a){$("#checkImg").attr("src","http://passport.727pan.cn/cgi/getVerfyImg/"+a)}function change(){$.ajax({url:"http://passport.727pan.cn/cgi/regsmscodestr",type:"post",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){1==a.respCode?($("#vcodestr").val(a.respData),$("#checkImg").attr("src",getImg(a.respData))):alert("\u670d\u52a1\u5668\u9519\u8bef")}})};